# 包大小

## 检索多余的资源文件工具

优点

- 能够检索出注释中的资源
- 未被使用到的暗黑模式资源
- 与业务耦合、但未被使用到的资源（非硬编码的资源）

## 抖音包大小实践（参考）

[抖音品质建设 - iOS 安装包大小优化实践篇](https://blog.csdn.net/ByteDanceTech/article/details/112504772)

- 包大小限制：OTA下载限制在200MB以内，iOS13之后，放宽到200MB以上
- `__TEXT`不可修改，Apple 对 `__TEXT`的大小也有限制
- 当限制在 150MB 并且无法下载的时候，对用户的新增有 10%的影响
- Apple对上传的包大小有调整，无法获取真正下载的包大小的变化
- Apple的优化技术：Apple Slicing 和 Asset.car只留下设备需要的尺寸

方法：

- 编译优化 Oz优化，Os为默认，O3的编译速度最快
- 图片使用WebP更好（实操确实压缩比更高）
- 代码扫描
  - 静态扫描
  - 动态扫描 LLVM

建议

- 将class method改为C函数（因为使用类方法在编译时，会生成类结构，调用通过objc_msgSend）
- property 使用 ivar
- 减少block的使用
- 减少方法参数和函数参数，不宜超过3个，当超过时，用构造对象传参

# 核心检索耗时

卡顿优化

- 图区优化
  - 异步绘制：在子线程中组织数据，在主线程中渲染
  - 数据聚合：不需要全部渲染，对路线的形状点做聚合
- 上层控件优化
  - 延迟加载
  - 使用drawRect方式渲染

