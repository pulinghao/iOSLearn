# 锁

- 锁是唯一资源，常规情况下，一个锁不能被重复加锁（否则会发生死锁），递归锁除外



## 自旋锁

- `OSSpinLock`
- 自旋锁，自旋的意思是指线程循环等待（busy waiting）
- 循环等待，不会释放资源（例如CPU、Lock等）
- 会有优先级倒置的问题，甚至是死锁的问题，原因是，低优先级线程拿到了锁，而高优先级线程线程没有锁；由于busy waiting，高优先级线程占用大量CPU资源，造成低优先级的线程拿不到CPU资源，形成了死锁。

## 互斥锁

- `mutex_lock` sleep waiting
- 保证共享数据操作的完整性, 锁被占用的时候会休眠, 等待锁释放的时候会唤醒。
- 加锁后，任何其他试图加锁的线程会被阻塞，直到当前线程解锁。
- `os_unfair_lock`作为`OSSpinLock`的替代品，更安全，而且让线程进入休眠状态